<!-- Product Details Page -->
{% extends 'base.html' %}
{% block content %}

<!-- Product Display -->
<div class="product-detail">
    <h1>{{ product.title }}</h1>
    <p>{{ product.description }}</p>
    <p><strong>Price:</strong> ${{ product.price }}</p>
    <img src="{{ url_for('static', filename=product.image_url) }}" alt="{{ product.title }} image" class="product-image">
    
    <!-- Add to Cart Button -->
    {% if current_user.is_authenticated %}
        <form action="{{ url_for('user.add_to_cart', product_id=product.id) }}" method="POST">
            <button type="submit" class="btn btn-primary">Add to Cart</button>
        </form>
    {% else %}
        <a href="{{ url_for('user.user_login') }}" class="btn btn-primary">Login to Add to Cart</a>
    {% endif %}

    <hr>

    <!-- Write a Review Button -->
    {% if current_user.is_authenticated %}
        <button class="btn btn-secondary" id="write-review-btn">Write a Review</button>
    {% else %}
        <a href="{{ url_for('user.user_login') }}" class="btn btn-secondary">Login to Write a Review</a>
    {% endif %}

    <!-- Review Form (Initially Hidden) -->
    <div id="review-form" style="display: none;">
        <form method="POST" action="{{ url_for('product.product_detail', product_id=product.id) }}">
            {{ form.hidden_tag() }}
            <div class="form-group">
                <label for="rating">Rating (1-5):</label>
                {{ form.rating(class="form-control") }}
            </div>
            <div class="form-group">
                <label for="comment">Comment:</label>
                {{ form.comment(class="form-control") }}
            </div>
            <button type="submit" class="btn btn-primary">Submit Review</button>
        </form>
    </div>

    <hr>

    <!-- Display Existing Reviews -->
    <h3>Reviews</h3>
    {% for review in reviews %}
        <div class="review">
            <p><strong>{{ review.user.username }}:</strong> {{ review.rating }} / 5</p>
            <p>{{ review.comment }}</p>
        </div>
    {% else %}
        <p>No reviews yet. Be the first to review!</p>
    {% endfor %}

    <!-- Related Products -->
    <h3>Related Products</h3>
    <div class="related-products">
        {% for related_product in related_products %}
            <div class="related-product">
                <h4>{{ related_product.title }}</h4>
                <p>${{ related_product.price }}</p>
                <a href="{{ url_for('product.product_detail', product_id=related_product.id) }}" class="btn btn-info">View Details</a>
            </div>
        {% endfor %}
    </div>

</div>

<script>
    // Toggle the review form visibility
    document.getElementById('write-review-btn').addEventListener('click', function() {
        var reviewForm = document.getElementById('review-form');
        reviewForm.style.display = reviewForm.style.display === 'none' ? 'block' : 'none';
    });
</script>

{% endblock %}
